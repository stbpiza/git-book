# 객체, 설계

- 이론이 먼저 vs 실무가 먼저
  - 소프트웨어 설계와 유지보수는 실무가 이론보다 앞서 있는 대표적인 분야들
- 이 책은 이론보다는 코드에 집중 할 것이다.


## 티켓 판매 애플리케이션 구현하기
- 상황 가정
  - 이벤트를 통해 무료 입장이 가능한 초대장을 발송
  - 입장 전 이벤트 당첨 여부 확인
  - 이벤트에 당첨된 관람객은 초대장을 티켓으로 교환하고 입장
  - 이벤트에 당첨되지 않은 관람객은 티켓을 구매하고 입장


- 이벤트 당첨자에게 초대장 발송
```java
public class Invitation {
    private LocalDateTime when;
}
```
   
- 공연을 관람하려면 티켓이 필요
```java
public class Ticket {
    private Long fee;
    
    public Long getFee() {
        return fee;
    }
}
```
   
- 관람객이 가지고 올 수 있는 소지품은 초대장, 현금, 티켓 세 가지
- 소지품을 가방에 담는다고 가정
```java
public class Bag {
    private Long amount;
    private Invitation invitation;
    private Ticket ticket;

    public boolean hasInvitation() {
        return invitation != null;
    }
    
    public boolean hasTicket() {
        return ticket != null;
    }
    
    public void setTicket(Ticket ticket) {
        this.ticket = ticket;
    }
    
    public void minusAmount(Long amount) {
        this.amount -= amount;
    }
    
    public void plusAmount(Long amount) {
        this.amount += amount;
    }
}
```

- 가방의 상태는 현금과 초대장을 함께 보관하거나, 초대장 없이 현금만 보관하거나 둘 중 하나
- 생성자에서 제약을 강제하도록 구현
```java
public class Bag {
    public Bag(Long amount) {
        this(null, amount);
    }
    
    public Bag(Invitation invitation, Long amount) {
        this.invitation = invitation;
        this.amount = amount;
    }
}

```

- 관람객을 구현
```java
public class Audience {
    private Bag bag;
        
    public Audience(Bag bag) {
        this.bag = bag;
    }
    
    public Bag getBag() {
        return bag;
    }
}
```

- 매표소를 구현
- 판매할 티켓과 판매 금액을 보관
```java
public class TicketOffice {
    private Long amount;
    private List<Ticket> tickets = new ArrayList<>();
    
    public TicketOffice(Long amount, Ticket ... tickets) {
        this.amount = amount;
        this.tickets.addAll(Arrays.asList(tickets));
    }
    
    public Ticket getTicket() {
        return tickets.remove(0);
    }
    
    public void minusAmount(Long amount) {
        this.amount -= amount;
    }
    
    public void plusAmount(Long amount) {
        this.amount += amount;
    }
}
```

- 판매원을 구현
- 초대장을 티켓으로 교환, 티켓 판매
- 자신이 일하는 매표소에 대한 정보
```java
public class TicketSeller {
    private TicketOffice ticketOffice;
    
    public TicketSeller(TicketOffice ticketOffice) {
        this.ticketOffice = ticketOffice;
    }
    
    public TicketOffice getTicketOffice() {
        return ticketOffice;
    }
}
```


- 소극장을 구현
- 관람객 입장을 처리
```java
public class Theater {
    private TicketSeller ticketSeller;
    
    public Theater(TicketSeller ticketSeller) {
        this.ticketSeller = ticketSeller;
    }
    
    public void enter(Audience audience) {
        if (audience.getBag().hasInvitation()) {
            Ticket ticket = ticketSeller.getTicketOffice().getTicket();
            audience.getBag().setTicket(ticket);
        } else {
            Ticket ticket = ticketSeller.getTicketOffice().getTicket();
            audience.getBag().minusAmount(ticket.getFee());
            ticketSeller.getTicketOffice().plusAmount(ticket.getFee());
            audience.getBag().setTicket(ticket);
        }
    }
}
```

- 이 코드들의 로직은 간단하고 예상대로 동작한다.
- 하지만 몇 가지 문제점이 있다.