## 학습 키워드

- 아래 문서를 읽어보시면 도움이 됩니다.
- https://learn.microsoft.com/ko-kr/azure/architecture/best-practices/api-design#organize-the-api-design-around-resources

<hr>

## 리소스를 중심으로 API 디자인 구성

- 다루고자 하는 리소스를 동사가 아닌 명사로 나타내야 한다.
- 동사는 메소드로 나타내야 한다.
```
/post-content (X)    
/content (O)
```
- 데이터베이스 내부 table 구조에 맞게 API를 만들지 말고, 수행하는 작업 단위로 만들어야 한다.
- 데이터베이스 구조나 내부 구현상황을 노출시키면 안되기 때문이다. (보안상 위험)
```
/order + /item + /address + ... (X)
/orders (O)
```

- 컬렉션으로 그룹화된 URI도 단일 항목과 별도로 만들어야 한다.
- 컬렉션으로 항목 목록을 검색하고, 항목별 고유 URI로 항목의 상세정보를 제공하는 방식
```
/orders (컬렉션)
/orders/1 (항목)
```

- 일관적인 명명 규칙을 사용해야 한다.
- 일반적으로는 복수 명사를 사용하여 컬렉션과 항목을 구성한다.
- 다른 리소스들을 연결할때는 계속 이어붙이는 형식보다는 아에 분리하는 방식이 좋다.
- `컬렉션/항목/컬렉션` 이상으로 복잡하게 하지 않는게 좋다.
```
/customers/1/orders/99/products (x)
/customers/1/orders + /orders/99/products (O)
```

## HTTP 메서드 측면에서 API 작업 정의

- GET - 검색, 조회
- POST - 새로운 리소스 등록
- PUT - 리소스를 만들거나 대체
- PATCH - 부분 업데이트
- DELETE - 리소스 제거


- URI에 대상 리소스를 표시했다면 메소드로 행위를 나타낸다.
- 같은 `/customers` 라도 GET, POST, PUT, DELETE에 따라 각각의 행동이 다르다.


- 하나의 리소스에 기본적인 CRUD를 생성해 주는것이 기본적인 패턴이다.
- 추가적으로 컬렉션 조회가 필요한 경우 GET에 컬렉션 조회까지 추가된다.

## HTTP 의미 체계 준수

### 미디어 유형
- 요청 또는 응답에 Content-Type 헤더에 표현 형식을 지정한다.
- 일반적으로는 JSON, XML을 사용
- 지원하지 않는 미디어 유형을 받으면 상태코드 415를 반환
- 어떤 미디어 유형인지 알 수 없으면 상태코드 406

### GET

- 성공시 200
- 리소스를 찾을 수 없으면 404
- 요청이 처리 되었지만 응답 내용이 없다면 204


- 파라미터를 잘못 지정하면 400으로 응답해주기도 합니다.

### POST

- 새 리소스 생성 성공하면 201
- 처리는 수행되었으나 새 리소스를 만들지는 않았다면 200에 반환 결과 응답
- 반환할 결과가 없다면 204
- 잘못된 데이터를 보냈다면 400


- 개인적으로 중복작성이 제한되어있는 경우 중복작성을 시도하면 409로 응답해주곤 합니다.

### PUT

- POST처럼 새 리소스 생성시에는 201
- 업데이트에 성공하면 200 또는 204
- 기존 리소스와 충돌로 업데이트에 실패하면 409

### PATCH

- 기본적으로 JSON을 활용해서 리소스를 수정
- JSON 병합 패치에서는 변경, 추가할 필드만 전송하면 되며, null로 필드를 삭제할 수 있음
- 때문에 원래 null값을 가질 수 있으면 JSON 병합 패치는 사용이 어려움 
- (삭제 요청인지, 수정하려는 필드가 아니어서 데이터가 안들어온건지 구분이 안되기 때문)


- 지원하지 않는 패치 문서 형식은 415
- 패치 문서 형식이 잘못되면 400
- 패치 문서가 유효하지만 현재 상태에서 변경이 불가한 경우 409

### DELETE

- 삭제에 성공했으나 본문에 내용이 없다면 204
- 삭제할 리소스를 못찾으면 404

### 비동기 작업

- 처리가 오래 걸리는 작업이 있을 수 있습니다.
- 처리를 다 기다리고 응답하려고 하면 응답 대기 제한시간에 걸릴 수 있기 때문에 202로 임시 응답이 가능합니다.
- 202로 임시 응답을 했다면 처리 상태를 확인할 수 있는 엔드포인트를 제시해줘야 합니다.
- 엔드포인트로 GET 요청을 보내면 현재 상태와 예상 완료시간, 작업 취소 등을 보내주면 됩니다.
- 작업 완료 후 엔드포인트로 요청이 오면 303을 반환해 주고 완료된 리소스를 조회할 URI를 Location 헤더에 추가합니다.

